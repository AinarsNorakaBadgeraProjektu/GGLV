import{R as L,L as W,r as t,j as e,B as w,T as h,G as E,a as k,f as V,H as le,V as ce,b as de,P as ue,J as pe,F as M,A as Z,Q as me,X as xe}from"./index-gyOQFbWm.js";import{u as he,C as T,S as q,N as te}from"./Select-ZJJzBZoW.js";import{T as B}from"./TextInput-D7ENN_nh.js";import{M as se}from"./MultiSelect-DuHHne1k.js";import{f as ge}from"./formatString-vRY8iWSD.js";import"./use-resolved-styles-api-DnEmOX7E.js";import"./InputBase-Ju6Otq6v.js";import"./Input-CUaF4mI9.js";import"./use-uncontrolled-YvCjPSRu.js";import"./CheckIcon-DCh9biyr.js";const fe="_mainContainer_190m4_1",je="_menuContainer_190m4_19",we="_input_190m4_43",ye="_dropdown_190m4_65",Ie="_option_190m4_79",be="_pill_190m4_87",s={mainContainer:fe,menuContainer:je,input:we,dropdown:ye,option:Ie,pill:be},Ce=({isNew:l,setName:i,items:o})=>{const r=L(W),{menu:u}=r,x=he(),[g,f]=t.useState(""),j=(!o.some(c=>c===g)?o.filter(c=>c.toLowerCase().includes(g.toLowerCase().trim())):o).map(c=>e.jsx(T.Option,{value:c,children:c},c));return t.useEffect(()=>{j.length==0&&l(!0)},[j]),e.jsxs(T,{onOptionSubmit:c=>{f(c),i(c),l(!1),x.closeDropdown()},store:x,classNames:{dropdown:s.dropdown,option:s.option},children:[e.jsx(T.Target,{children:e.jsx(B,{label:u.name,placeholder:u.namePlaceholder,value:g,onChange:c=>{f(c.currentTarget.value),i(c.currentTarget.value),x.openDropdown(),x.updateSelectedOptionIndex()},onClick:()=>x.openDropdown(),onFocus:()=>x.openDropdown(),onBlur:()=>x.closeDropdown(),size:"xs",classNames:{input:s.input}})}),e.jsx(T.Dropdown,{children:e.jsx(T.Options,{children:j.length===0?e.jsx(T.Empty,{children:u.isNew}):j})})]})},Se=l=>new Promise(i=>{const o=new Image;o.src=l,o.complete?i(!0):(o.onload=()=>{i(!0)},o.onerror=()=>{i(!1)})}),ze=({types:l,show:i})=>{const o=L(W),{menu:r}=o,[u,x]=t.useState([]),[g,f]=t.useState([]),[z,A]=t.useState([]),[j,c]=t.useState([]),[d,_]=t.useState([]),[y,v]=t.useState(!1),[P,I]=t.useState(null),[a,b]=t.useState(""),[D,C]=t.useState(""),[R,O]=t.useState(!1),[S,G]=t.useState(null),[H,Q]=t.useState(0),[J,U]=t.useState(null),[X,n]=t.useState(null),[p,F]=t.useState(5),ne=m=>{m.length<40&&b(m)},ie=()=>{i(!1),V("av_business","addItem",{name:P,description:a,image:D,type:S,ingredients:J,price:H,isNew:y,prop:X})},oe=async m=>{O(!1),await Se(m)?C(m):(C(""),O(!0))},re=m=>{G(m);const N=z.filter(Y=>{var $;return(($=Y.type)==null?void 0:$.includes(m))??!1}),ae=g.filter(Y=>{var $;return(($=Y.type)==null?void 0:$.includes(m))??!1});_(N),c(ae)};return t.useEffect(()=>{(async()=>{const N=await V("av_business","getNewItem");N?(x(N.items),f(N.animations),A(N.ingredients),F(N.maxIngredients)):(console.log("[ERROR] We couldn't fetch the info from getNewItem, verify it with your server admin."),console.log("[ERROR] We couldn't fetch the info from getNewItem, verify it with your server admin."),console.log("[ERROR] We couldn't fetch the info from getNewItem, verify it with your server admin."),i(!1))})()},[]),e.jsx(w,{className:s.mainContainer,children:e.jsxs(w,{className:s.menuContainer,children:[e.jsx(h,{ta:"center",fw:500,size:"lg",children:r.add}),e.jsxs(w,{p:"xs",children:[e.jsx(Ce,{isNew:v,setName:I,items:u}),e.jsx(B,{label:r.productDescription,placeholder:r.descriptionPlaceholder,value:a,size:"xs",mt:"xs",classNames:{input:s.input},onChange:m=>{ne(m.target.value)}}),y&&e.jsx(e.Fragment,{children:e.jsx(B,{label:r.productImage,value:D,placeholder:r.imagePlaceholder,size:"xs",mt:"xs",classNames:{input:s.input},error:R,onError:()=>{C("")},onChange:m=>{oe(m.target.value)}})}),e.jsx(q,{label:r.productType,data:l,size:"xs",mt:"xs",classNames:{input:s.input,dropdown:s.dropdown,option:s.option},onChange:m=>{re(m)},searchable:!0}),S&&e.jsxs(e.Fragment,{children:[e.jsx(q,{label:r.animation,data:j,size:"xs",mt:"xs",classNames:{input:s.input,dropdown:s.dropdown,option:s.option},onChange:n,searchable:!0}),e.jsx(se,{label:o.ingredients,data:d,size:"xs",mt:"xs",classNames:{input:s.input,dropdown:s.dropdown,option:s.option,pill:s.pill},onChange:U,maxValues:p,searchable:!0})]}),e.jsx(te,{label:r.suggestedPrice,mt:"xs",size:"xs",classNames:{input:s.input},onChange:Q,required:!0}),e.jsxs(E,{mt:"md",grow:!0,children:[e.jsx(k,{size:"xs",variant:"light",color:"cyan",onClick:()=>{ie()},disabled:!S&&!P,children:o.confirm}),e.jsx(k,{size:"xs",variant:"light",color:"red",onClick:()=>{i(!1)},children:o.cancel})]})]})]})})},_e=({types:l,item:i,ingredients:o,show:r,animations:u,maxIngredients:x})=>{const g=L(W),{menu:f}=g,[z,A]=t.useState(o.filter(a=>a.type.includes(i.type))),[j,c]=t.useState(u.filter(a=>a.type.includes(i.type))),[d,_]=t.useState(i),[y,v]=t.useState(i.ingredients),P=()=>{V("av_business","editItem",d),r(!1)},I=(a,b)=>{if(a=="type"){const C=u.filter(S=>S.type.includes(b)),R=o.filter(S=>S.type.includes(b));c(C),A(R);const O={...d,prop:null,ingredients:null,type:b};_(O),v([]);return}if(a=="ingredients"){const C={...d,ingredients:b};_(C),v(b);return}const D={...d,[a]:b};_(D)};return e.jsx(w,{className:s.mainContainer,children:e.jsxs(w,{className:s.menuContainer,children:[e.jsx(h,{ta:"center",fw:500,size:"lg",children:f.edit_header}),e.jsxs(w,{p:"xs",children:[e.jsx(B,{label:f.name,value:d.label,size:"xs",mt:"xs",classNames:{input:s.input},disabled:!0}),e.jsx(B,{label:f.productDescription,value:d.description,size:"xs",mt:"xs",classNames:{input:s.input},onChange:a=>{I("description",a.target.value)}}),e.jsx(q,{label:f.productType,defaultValue:d.type?d.type:null,data:l,size:"xs",mt:"xs",classNames:{input:s.input,dropdown:s.dropdown,option:s.option},onChange:a=>{I("type",a)}}),e.jsx(q,{label:f.animation,data:j,value:d.prop?d.prop:null,size:"xs",mt:"xs",classNames:{input:s.input,dropdown:s.dropdown,option:s.option},onChange:a=>{I("prop",a)}}),e.jsx(se,{label:g.ingredients,value:y,data:z,size:"xs",mt:"xs",classNames:{input:s.input,dropdown:s.dropdown,option:s.option,pill:s.pill},maxValues:x,onChange:a=>{I("ingredients",a)}}),e.jsx(te,{label:f.suggestedPrice,value:d.price?d.price:0,mt:"xs",size:"xs",classNames:{input:s.input},required:!0,onChange:a=>{I("price",a)}}),e.jsxs(E,{mt:"md",grow:!0,children:[e.jsx(k,{size:"xs",variant:"light",color:"cyan",onClick:()=>{P()},disabled:!d.type,children:g.confirm}),e.jsx(k,{size:"xs",variant:"light",color:"red",onClick:()=>{r(!1)},children:g.cancel})]})]})]})})},ve="_itemContainer_tq1zc_1",Ne="_item_tq1zc_1",Ae="_option_tq1zc_23",K={itemContainer:ve,item:Ne,option:Ae},Ee="_container_16kp1_1",ke="_box_16kp1_25",ee={container:Ee,box:ke},Pe=({item:l,show:i,handleDelete:o})=>{const r=L(W),{menu:u}=r;return e.jsx(w,{className:ee.container,children:e.jsxs(w,{className:ee.box,children:[e.jsx(h,{fw:500,fz:"md",ta:"center",children:u.delete_header}),e.jsx(h,{fw:200,fz:"sm",ta:"center",c:"gray.6",children:ge(u.delete_text,l.label)}),e.jsxs(E,{grow:!0,mt:"md",w:"80%",ml:"auto",mr:"auto",mb:"xs",children:[e.jsx(k,{size:"xs",variant:"light",color:"teal",onClick:()=>{o(l.name)},children:r.confirm}),e.jsx(k,{size:"xs",variant:"light",color:"red",onClick:()=>{i(!1)},children:r.cancel})]})]})})},De=(l,i)=>{try{return Array.isArray(l)&&l.length>0?l.map(r=>{const u=i.find(x=>x.value===r);return u?u.label:r}).join(", "):"N/A"}catch(o){return console.error(`Failed to parse ingredients: ${l}`,o),"N/A"}},We=()=>{const l=L(W),{menu:i}=l,o=L(le),[r,u]=t.useState(!1),[x,g]=t.useState(!1),[f,z]=t.useState(!1),[A,j]=t.useState({}),[c,d]=t.useState([]),[_,y]=t.useState([]),[v,P]=t.useState([]),[I,a]=t.useState([]),[b,D]=t.useState([]),[C,R]=t.useState(!1),[O,S]=t.useState(""),[G,H]=t.useState(5);ce("updateMenu",n=>{d(n),y(n)});const Q=n=>{j(n),g(!0)},J=n=>{j(n),z(!0)},U=n=>{if(!n){y(c);return}const p=c.filter(F=>F.type===n);y(p)},X=n=>{z(!1);const p=c.filter(F=>F.name!==n);y(p),d(p),V("av_business","deleteItem",n)};return t.useEffect(()=>{(async()=>{const p=await V("av_business","getMenu");p?(d(p.items),y(p.items),P(p.types),a(p.ingredients),D(p.animations),S(p.inventory),H(p.maxIngredients),setTimeout(()=>{R(!0)},100)):(console.log("An error ocured while trying to fetch the menu tab, report it to an admin."),console.log("An error ocured while trying to fetch the menu tab, report it to an admin."),console.log("An error ocured while trying to fetch the menu tab, report it to an admin."))})()},[]),e.jsxs(e.Fragment,{children:[r&&e.jsx(ze,{types:v,show:u}),x&&e.jsx(_e,{types:v,item:A,show:g,animations:b,ingredients:I,maxIngredients:G}),f&&e.jsx(Pe,{item:A,show:z,handleDelete:X}),C?e.jsxs(w,{h:o>900?"calc(100%)":"calc(95%)",children:[e.jsxs(E,{justify:"space-between",align:"center",display:"flex",children:[e.jsx(h,{fz:"md",fw:500,children:`${_.length} Product(s)`}),e.jsxs(E,{children:[e.jsx(k,{size:"xs",variant:"light",color:"teal.4",onClick:()=>{u(!0)},children:i.add}),e.jsx(q,{placeholder:l.filter,data:v,classNames:{option:K.option},styles:{input:{backgroundColor:"rgba(39, 43, 54, 0.15)"},dropdown:{backgroundColor:"rgba(39, 43, 54, 0.9)"}},onChange:n=>{U(n)},size:"xs"})]})]}),e.jsx(w,{mt:"md",className:K.itemContainer,h:o>900?"calc(90%)":"calc(80%)",children:_.map((n,p)=>e.jsx(ue,{className:K.item,mb:"xs",p:"xs",children:e.jsxs(E,{grow:!0,justify:"space-between",w:"100%",children:[e.jsx(pe,{src:n.image?n.image:`${`https://cfx-nui-${O}${n==null?void 0:n.name}.png`}`,w:40,h:40,fallbackSrc:"https://r2.fivemanage.com/QmVAYSlqeAlD4IxVbdvu5/cono.png"}),e.jsxs(M,{justify:"center",align:"flex-start",direction:"column",wrap:"wrap",w:100,style:{overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(h,{fz:"sm",c:"dimmed",children:i.product}),e.jsx(h,{fz:"sm",truncate:!0,maw:"65%",children:n.label})]}),e.jsxs(M,{justify:"center",align:"flex-start",direction:"column",wrap:"wrap",children:[e.jsx(h,{fz:"sm",c:"dimmed",children:i.description}),e.jsx(h,{fz:"sm",children:n.description})]}),e.jsxs(M,{justify:"center",align:"flex-start",direction:"column",wrap:"wrap",children:[e.jsx(h,{fz:"sm",c:"dimmed",children:l.ingredients}),e.jsx(h,{fz:"sm",children:n.ingredients?De(n.ingredients,I):"N/A"})]}),e.jsxs(M,{justify:"center",align:"flex-start",direction:"column",wrap:"wrap",children:[e.jsx(h,{fz:"sm",c:"dimmed",children:i.suggestedPrice}),e.jsx(h,{fz:"sm",children:n.price?`$${n.price.toLocaleString("en-US")}`:0})]}),e.jsxs(M,{justify:"center",align:"flex-start",direction:"column",wrap:"wrap",children:[e.jsx(h,{fz:"sm",c:"dimmed",children:l.type}),e.jsx(h,{fz:"sm",tt:"capitalize",children:n.type})]}),e.jsxs(E,{justify:"center",children:[e.jsx(Z,{size:"sm",variant:"light",color:"cyan.4",onClick:()=>{Q(n)},children:e.jsx(me,{style:{width:"70%",height:"70%"}})}),e.jsx(Z,{size:"sm",variant:"light",color:"red.4",onClick:()=>{J(n)},children:e.jsx(xe,{style:{width:"70%",height:"70%"}})})]})]})},p))})]}):e.jsx(w,{style:{display:"flex",alignContent:"center",alignItems:"center",height:"100%"},children:e.jsx(de,{visible:!0,zIndex:1e3,loaderProps:{color:"teal",type:"dots"},overlayProps:{radius:"sm",blur:2,opacity:0}})})]})};export{We as default};
