import{R as j,L as f,j as e,B as n,P as v,G as h,T as d,F as _,a as E,r as i,b as L,f as m}from"./index-gyOQFbWm.js";import{D as F}from"./Divider-D0-CmhI-.js";const O="_container_xz5ik_1",S="_cashier_xz5ik_15",B="_content_xz5ik_37",T="_box_xz5ik_59",M="_panel_xz5ik_71",D="_products_xz5ik_89",G="_product_xz5ik_89",I="_glow_xz5ik_121",W="_empty_xz5ik_139",s={container:O,cashier:S,content:B,box:T,panel:M,products:D,product:G,glow:I,empty:W},q=l=>{const a={};return l.forEach(t=>{const c=`${t.label}|${t.ingredients.sort().join(",")}`;a[c]||(a[c]={count:0,totalPrice:0,product:t}),a[c].count+=1,a[c].totalPrice+=t.price}),Object.keys(a).map(t=>{const{count:c,totalPrice:u,product:r}=a[t];return{...r,label:`${c} ${r.label}`,price:u}})},A=({cart:l,buttons:a,handlePay:x})=>{const t=j(f),{cashier:c}=t,u=q(l);return e.jsx(e.Fragment,{children:l.length>0?e.jsxs(e.Fragment,{children:[e.jsx(n,{className:s.products,children:u.map((r,g)=>e.jsxs(v,{className:s.product,display:"block",mb:5,p:"xs",maw:"99%",children:[e.jsx(h,{children:e.jsx(d,{fz:"md",truncate:!0,c:"rgba(225,225,225,1)",children:r.label})}),e.jsxs(_,{gap:0,justify:"flex-start",align:"flex-start",direction:"column",wrap:"wrap",children:[e.jsxs(d,{fz:"xs",children:[e.jsxs("a",{style:{fontWeight:500,color:"rgba(225,225,225,1)"},children:[t.price,": "]})," ",`$${r.price}`]}),e.jsxs(d,{fz:"xs",ta:"left",tt:"capitalize",children:[e.jsxs("a",{style:{fontWeight:500,color:"rgba(225,225,225,1)"},children:[t.ingredients,": "]}),`${r.ingredients.join(", ")}`]})]})]},g))}),e.jsx(h,{mt:"xs",grow:!0,children:a.map((r,g)=>e.jsx(E,{size:"xs",variant:"light",color:r.color,onClick:()=>{x(r.account)},children:r.label},g))})]}):e.jsx(n,{className:s.empty,children:c.empty})})},K=({serial:l})=>{const a=j(f),{cashier:x}=a,[t,c]=i.useState([]),[u,r]=i.useState([]),[g,y]=i.useState(0),[b,z]=i.useState(""),[w,N]=i.useState(!1),$=async p=>{await m("av_business","pay",{account:p,serial:l})&&c([])};return i.useEffect(()=>{let p=!0;(async()=>{try{const o=await m("av_business","getCart",l);if(o&&p){if(o.cart){c(o.cart);const P=o.cart.reduce((C,R)=>C+R.price,0);y(P)}r(o.buttons),o.order&&z(o.order),setTimeout(()=>{N(!0)},100)}else console.error("[ERROR] getCart returned null, try again or report it to your server admin.")}catch(o){console.error("[ERROR] getCart encountered an error:",o)}})()},[]),e.jsx(e.Fragment,{children:w?e.jsx(n,{className:s.container,children:e.jsx(n,{className:s.cashier,children:e.jsx(n,{className:s.content,children:e.jsxs(n,{className:s.box,children:[e.jsxs(h,{justify:"space-between",p:"xs",children:[e.jsx(d,{fz:"lg",fw:500,className:s.glow,children:`${a.order} #${b}`}),e.jsxs(_,{gap:0,justify:"flex-start",align:"flex-start",direction:"column",wrap:"wrap",children:[e.jsx(d,{fz:"sm",c:"gray.5",className:s.glow,children:`${x.products}: ${t.length}`}),e.jsx(d,{fz:"sm",c:"gray.5",className:s.glow,children:`${x.total}: $${g}`})]})]}),e.jsx(F,{}),e.jsx(A,{cart:t,buttons:u,handlePay:$})]})})})}):e.jsx(n,{className:s.container,children:e.jsx(n,{className:s.cashier,children:e.jsx(n,{className:s.content,children:e.jsx(n,{className:s.box,children:e.jsx(n,{style:{display:"flex",alignContent:"center",alignItems:"center"},children:e.jsx(L,{visible:!0,zIndex:1e3,loaderProps:{color:"teal",type:"dots"},overlayProps:{radius:"sm",blur:2,opacity:0}})})})})})})})};export{K as default};
